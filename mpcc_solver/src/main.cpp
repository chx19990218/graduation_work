#include <ros/ros.h>
#include "config.h"
#include "arc_length_spline.h"
#include <matplotlibcpp.h>
namespace plt = matplotlibcpp;
int main(int argc, char** argv)
{
  ros::init(argc, argv, "mpcc_node");
  ros::NodeHandle n;
  ros::NodeHandle nh("~");

  ros::Rate rate(100);

  // State state;
  // Input input;
  ArcLengthSpline track;
  Eigen::VectorXd X, Y;
  
  std::vector<double> x{-0.806909161115358, -0.777153063554383, -0.747396965993407, -0.717640868432431, -0.687884770871456, -0.658128673310480, -0.628372575749505, -0.598616478188529, -0.568860380627553, -0.539104283066578, -0.509348185505602, -0.479592087944627, -0.449835990383651, -0.420079892822675, -0.390323795261700, -0.360567697700724, -0.330811600139748, -0.301055502578773, -0.271299405017797, -0.241543307456822, -0.211787209895846, -0.182031112334871, -0.152275014773895, -0.122518917212919, -0.092762819651944, -0.063006722090968, -0.033250624529993, -0.003494526969017, 0.026261570591959, 0.056017668152934, 0.085773765713910, 0.115529863274886, 0.145285960835861, 0.175042058396837, 0.204798155957812, 0.234554253518788, 0.264310351079764, 0.294066448640739, 0.323822546201715, 0.353578643762690, 0.381972717115482, 0.414215799025621, 0.449209890009973, 0.485763308270852, 0.522631270990376, 0.558558283916380, 0.592320895713371, 0.622769361130392, 0.648866794196576, 0.669724478129274, 0.684632129518193, 0.693082086175041, 0.694786594960475, 0.689687610872139, 0.677958773697604, 0.659999494919660, 0.636421356237310, 0.603318472977926, 0.570215589718542, 0.537112706459159, 0.504009823199775, 0.470906939940392, 0.437804056681008, 0.404701173421624, 0.371598290162241, 0.338495406902857, 0.305392523643474, 0.272289640384090, 0.239186757124707, 0.206083873865323, 0.182539190043269, 0.163254325490680, 0.148646739286187, 0.139032641557236, 0.134620148485760, 0.135504777221339, 0.141667378223364, 0.152974549790762, 0.169181525805961, 0.189937474182157, 0.214793091318508, 0.243210328166225, 0.274574037365608, 0.308205289328684, 0.343376069014464, 0.379325035256027, 0.421460028204822, 0.463595021153616, 0.505730014102411, 0.547865007051205, 0.590000000000000, 0.626732453924648, 0.663319941635118, 0.699618069032649, 0.735483583991440, 0.770774941709344, 0.805352863320537, 0.839080885565567, 0.871825899349503, 0.903458675062713, 0.933854372591097, 0.962893034002984, 0.990460056968283, 1.016446647041526, 1.040750247023837, 1.063274941709344, 1.083931836418679, 1.102639407825660, 1.119323825692621, 1.133919244244627, 1.146368062032665, 1.156621149260249, 1.164638041676283, 1.170387100268969, 1.173845636130539, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.175000000000000, 1.174138862096527, 1.171557439147153, 1.163171298356061, 1.153147349593884, 1.141527601272247, 1.128357575342106, 1.113686158920028, 1.097565448640605, 1.080050588193401, 1.061199599517151, 1.041073208136994, 1.019734663142225, 0.997249552312359, 0.973685612908268, 0.949112538652682, 0.923601783430485, 0.897226362243943, 0.870060649961281, 0.842180178398895, 0.813661432277927, 0.784581644594921, 0.755018591943942, 0.725050390323716, 0.694755291958254, 0.664211483652858, 0.633496887199654, 0.602688962337607, 0.571864512761616, 0.541099495663639, 0.510468835276003, 0.480046240873020, 0.449904029671998, 0.420112955058534, 0.390742040543818, 0.361858419843527, 0.333527183448823, 0.305811232040072, 0.278771137073152, 0.252465008846795, 0.226948372337232, 0.202274051063678, 0.178492059224855, 0.155649502322978, 0.133790486467366, 0.112956036525282, 0.093184023262713, 0.074509099592713, 0.054183802343924, 0.034727309316720, 0.011433080086344, -0.011451986215542, -0.034337052517428, -0.057222118819314, -0.080107185121200, -0.102992251423086, -0.125877317724971, -0.148762384026858, -0.171647450328743, -0.194532516630629, -0.217417582932515, -0.240302649234401, -0.263187715536287, -0.286072781838173, -0.308957848140059, -0.331842914441945, -0.354727980743831, -0.377613047045717, -0.400498113347603, -0.423383179649489, -0.446268245951375, -0.469153312253261, -0.492038378555147, -0.514923444857033, -0.537808511158919, -0.560693577460805, -0.583578643762691, -0.611387050653769, -0.642917438909449, -0.677136867142489, -0.712924300515543, -0.749107336051065, -0.784500610771041, -0.817944634408754, -0.848343774525709, -0.874702149634220, -0.896156254460289, -0.912003248537083, -0.921723981389429, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.925000000000000, -0.922561785491536, -0.915288860492385, -0.903305666765717, -0.886817240078565, -0.866105701983002, -0.841525432638166, -0.813497007267485, -0.782500000000000, -0.749064778224051, -0.713763427854218, -0.677199964782715, -0.640000000000000, -0.607500000000000, -0.575000000000000, -0.538250096436686, -0.502751666762569, -0.469713567424529, -0.440260871270689, -0.415396554543952, -0.395967341728987, -0.382634871365436, -0.375853164740993, -0.375853164740993, -0.382634871365436, -0.395967341728987, -0.415396554543952, -0.440260871270689, -0.469713567424529, -0.502751666762569, -0.538250096436686, -0.575000000000000, -0.612500000000000, -0.650000000000000, -0.687500000000000, -0.725000000000000, -0.761749903563314, -0.797248333237431, -0.830286432575471, -0.859739128729311, -0.884603445456048, -0.904032658271013, -0.917365128634564, -0.924146835259007, -0.924146835259007, -0.917365128634564, -0.904032658271013, -0.884603445456048, -0.859739128729311, -0.830286432575471, -0.797248333237431, -0.761749903563314, -0.725000000000000, -0.688260869565217, -0.651521739130435, -0.614782608695652, -0.578043478260870, -0.541304347826087, -0.504565217391304, -0.467826086956522, -0.431086956521739, -0.394347826086957, -0.357608695652174, -0.320869565217391, -0.284130434782609, -0.247391304347826, -0.210652173913043, -0.173913043478261, -0.137173913043478, -0.100434782608696, -0.063695652173913, -0.026956521739130, 0.009782608695652, 0.046521739130435, 0.083260869565217, 0.119500000000000, 0.155689254733992, 0.190487776703724, 0.222558278225136, 0.250668307910105, 0.273737613082122, 0.290879653280844, 0.301435669514799, 0.305000000000000, 0.308564330485201, 0.319120346719156, 0.336262386917878, 0.359331692089895, 0.387441721774864, 0.419512223296276, 0.454310745266008, 0.490500000000000, 0.526000000000000, 0.562000000000000, 0.598000000000000, 0.634000000000000, 0.670000000000000, 0.706000000000000, 0.742000000000000, 0.778000000000000, 0.814000000000000, 0.850000000000000, 0.885924346446926, 0.921767312694658, 0.957447702896331, 0.992884689492110, 1.027997996309618, 1.062708080415280, 1.096936312304653, 1.130605154023547, 1.163638334816424, 1.195961023904195, 1.227500000000000, 1.258183817178976, 1.287942966726255, 1.316710034596557, 1.344419854128690, 1.371009653668994, 1.396419198769328, 1.420590928637465, 1.443470086530805, 1.465004843798003, 1.485146417287542, 1.503849179857252, 1.521070763734467, 1.536772156492662, 1.550917789427135, 1.563475618129575, 1.574417195078945, 1.583717734084274, 1.591356166433344, 1.597315188620104, 1.601581301542679, 1.604144841083171, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.605000000000000, 1.604342855644686, 1.602372299408598, 1.599090960611347, 1.594503217553984, 1.588615191677024, 1.581434739392588, 1.572971441601564, 1.563236590909780, 1.552243176560245, 1.540005867101560, 1.526540990815622, 1.511866513930749, 1.496002016649281, 1.478968667021650, 1.460789192701786, 1.441487850621530, 1.421090394624532, 1.399624041102815, 1.377117432681854, 1.353600600002625, 1.329104921651626, 1.303663082292325, 1.277309029053906, 1.250077926235508, 1.222006108386382, 1.193131031824584, 1.163491224658889, 1.133126235380611, 1.102076580093919, 1.070383688455069, 1.038089848392678, 1.005238149682804, 0.971872426454116, 0.938037198699875, 0.903777612874759, 0.869139381655806, 0.834168722947834, 0.798912298214745, 0.763417150218980, 0.727730640252206, 0.691900384940994, 0.655974192711794, 0.620000000000000, 0.583648648648649, 0.547297297297297, 0.510945945945946, 0.474594594594595, 0.438243243243243, 0.401891891891892, 0.365540540540541, 0.329189189189189, 0.292837837837838, 0.256486486486486, 0.220135135135135, 0.183783783783784, 0.147432432432432, 0.111081081081081, 0.074729729729730, 0.038378378378378, 0.002027027027027, -0.034324324324324, -0.070675675675676, -0.107027027027027, -0.143378378378378, -0.179729729729730, -0.216081081081081, -0.252432432432432, -0.288783783783784, -0.325135135135135, -0.361486486486486, -0.397837837837838, -0.434189189189189, -0.470540540540541, -0.506891891891892, -0.543243243243243, -0.579594594594595, -0.615945945945946, -0.652297297297297, -0.688648648648649, -0.725000000000000, -0.761051007562781, -0.795920977408507, -0.828467562835531, -0.857624531648159, -0.882436696121810, -0.902091205130642, -0.915944173301709, -0.923541774819611, -0.924635110844664, -0.919188363485210, -0.907379969198418, -0.889596773178731, -0.866421356237310};
  X = Eigen::Map<Eigen::VectorXd>(x.data(), x.size());
  std::vector<double> y{1.059066448640739, 1.029310351079764, 0.999554253518788, 0.969798155957812, 0.940042058396837, 0.910285960835861, 0.880529863274885, 0.850773765713910, 0.821017668152934, 0.791261570591959, 0.761505473030983, 0.731749375470008, 0.701993277909032, 0.672237180348056, 0.642481082787081, 0.612724985226105, 0.582968887665129, 0.553212790104154, 0.523456692543178, 0.493700594982203, 0.463944497421227, 0.434188399860251, 0.404432302299276, 0.374676204738300, 0.344920107177325, 0.315164009616349, 0.285407912055373, 0.255651814494398, 0.225895716933422, 0.196139619372447, 0.166383521811471, 0.136627424250495, 0.106871326689520, 0.077115229128544, 0.047359131567569, 0.017603034006593, -0.012153063554383, -0.041909161115358, -0.071665258676334, -0.101421356237310, -0.124999494919661, -0.142958773697604, -0.154687610872139, -0.159786594960475, -0.158082086175041, -0.149632129518193, -0.134724478129274, -0.113866794196576, -0.087769361130392, -0.057320895713371, -0.023558283916380, 0.012368729009624, 0.049236691729148, 0.085790109990027, 0.120784200974379, 0.153027282884518, 0.181421356237310, 0.214524239496693, 0.247627122756077, 0.280730006015460, 0.313832889274844, 0.346935772534227, 0.380038655793611, 0.413141539052995, 0.446244422312378, 0.479347305571762, 0.512450188831145, 0.545553072090529, 0.578655955349912, 0.611758838609296, 0.639053670399354, 0.669507799477631, 0.702461985918906, 0.737202871106049, 0.772978419789783, 0.809014199380742, 0.844530144076300, 0.878757440929447, 0.910955172327339, 0.940426354620093, 0.966533025711965, 0.988710055014124, 1.006477376815244, 1.019450382254391, 1.027348244941371, 1.030000000000000, 1.030000000000000, 1.030000000000000, 1.030000000000000, 1.030000000000000, 1.030000000000000, 1.028845636130539, 1.025387100268969, 1.019638041676283, 1.011621149260249, 1.001368062032665, 0.988919244244627, 0.974323825692621, 0.957639407825660, 0.938931836418679, 0.918274941709344, 0.895750247023837, 0.871446647041526, 0.845460056968283, 0.817893034002984, 0.788854372591097, 0.758458675062713, 0.726825899349503, 0.694080885565567, 0.660352863320537, 0.625774941709344, 0.590483583991440, 0.554618069032649, 0.518319941635118, 0.481732453924648, 0.445000000000000, 0.408333333333333, 0.371666666666667, 0.335000000000000, 0.298333333333333, 0.261666666666667, 0.225000000000000, 0.188333333333333, 0.151666666666667, 0.115000000000000, 0.078333333333333, 0.041666666666667, 0.005000000000000, -0.030809969529247, -0.066537154301223, -0.101504765361300, -0.135832933718591, -0.169445500451467, -0.202268862607820, -0.234232133876193, -0.265267296914125, -0.295309347008254, -0.324296426765459, -0.352169951559705, -0.378874725485156, -0.404359047592541, -0.428574808212563, -0.451477575197306, -0.473026669938009, -0.493185233045191, -0.511920279604860, -0.529202743952299, -0.545007513932719, -0.559313454645677, -0.572103421697725, -0.583364264014924, -0.593086816293876, -0.601265881196447, -0.607900201419490, -0.612992421796474, -0.616549041612985, -0.618580357342408, -0.619100396031841, -0.618126839591206, -0.615680940260627, -0.611787427552451, -0.606474406984556, -0.599773250941027, -0.591718482014588, -0.582347649202503, -0.571701197343869, -0.559822330201285, -0.546756867603789, -0.532553097080699, -0.517261620427436, -0.500935195654689, -0.483628574781255, -0.465398337938553, -0.446302724261242, -0.426401460043446, -0.408815400365101, -0.390272690683280, -0.367387624381394, -0.344502558079508, -0.321617491777622, -0.298732425475736, -0.275847359173850, -0.252962292871964, -0.230077226570078, -0.207192160268192, -0.184307093966307, -0.161422027664421, -0.138536961362535, -0.115651895060649, -0.092766828758763, -0.069881762456877, -0.046996696154991, -0.024111629853105, -0.001226563551219, 0.021658502750667, 0.044543569052553, 0.067428635354439, 0.090313701656325, 0.113198767958211, 0.136083834260097, 0.158968900561983, 0.181853966863869, 0.204739033165755, 0.227624099467641, 0.250799516409062, 0.268582712428749, 0.280391106715542, 0.285837854074994, 0.284744518049942, 0.277146916532040, 0.263293948360973, 0.243639439352141, 0.218827274878490, 0.189670306065862, 0.157123720638838, 0.122253750793112, 0.086202743230331, 0.049661405393253, 0.013120067556175, -0.023421270280904, -0.059962608117982, -0.096503945955060, -0.133045283792139, -0.169586621629217, -0.206127959466295, -0.242669297303374, -0.279210635140452, -0.315751972977530, -0.352293310814609, -0.388834648651687, -0.425375986488765, -0.461917324325843, -0.498458662162922, -0.535000000000000, -0.572199964782715, -0.608763427854218, -0.644064778224051, -0.677500000000000, -0.708497007267485, -0.736525432638166, -0.761105701983002, -0.781817240078565, -0.798305666765717, -0.810288860492384, -0.817561785491536, -0.820000000000000, -0.820000000000000, -0.820000000000000, -0.823405380063220, -0.833505554119129, -0.849956572854077, -0.872198216555868, -0.899473072724149, -0.930852328844693, -0.965267401985583, -1.001546328107340, -1.038453671892660, -1.074732598014417, -1.109147671155308, -1.140526927275851, -1.167801783444132, -1.190043427145923, -1.206494445880871, -1.216594619936780, -1.220000000000000, -1.220000000000000, -1.220000000000000, -1.220000000000000, -1.220000000000000, -1.223405380063220, -1.233505554119129, -1.249956572854077, -1.272198216555868, -1.299473072724149, -1.330852328844693, -1.365267401985583, -1.401546328107340, -1.438453671892660, -1.474732598014417, -1.509147671155308, -1.540526927275851, -1.567801783444132, -1.590043427145923, -1.606494445880871, -1.616594619936780, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.620000000000000, -1.616435669514799, -1.605879653280844, -1.588737613082122, -1.565668307910104, -1.537558278225136, -1.505487776703724, -1.470689254733992, -1.434500000000000, -1.399310745266008, -1.364512223296276, -1.332441721774864, -1.304331692089896, -1.281262386917878, -1.264120346719156, -1.253564330485201, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.250000000000000, -1.249144841083171, -1.246581301542679, -1.242315188620104, -1.236356166433344, -1.228717734084274, -1.219417195078946, -1.208475618129575, -1.195917789427135, -1.181772156492662, -1.166070763734467, -1.148849179857251, -1.130146417287542, -1.110004843798003, -1.088470086530805, -1.065590928637465, -1.041419198769328, -1.016009653668995, -0.989419854128690, -0.961710034596557, -0.932942966726255, -0.903183817178976, -0.872500000000000, -0.840961023904195, -0.808638334816424, -0.775605154023547, -0.741936312304654, -0.707708080415279, -0.672997996309618, -0.637884689492110, -0.602447702896330, -0.566767312694658, -0.530924346446926, -0.495000000000000, -0.459074074074074, -0.423148148148148, -0.387222222222222, -0.351296296296296, -0.315370370370370, -0.279444444444445, -0.243518518518518, -0.207592592592592, -0.171666666666667, -0.135740740740741, -0.099814814814815, -0.063888888888889, -0.027962962962963, 0.007962962962963, 0.043888888888889, 0.079814814814815, 0.115740740740741, 0.151666666666667, 0.187592592592593, 0.223518518518518, 0.259444444444445, 0.295370370370370, 0.331296296296296, 0.367222222222222, 0.403148148148148, 0.439074074074074, 0.475000000000000, 0.510974192711794, 0.546900384940994, 0.582730640252206, 0.618417150218980, 0.653912298214745, 0.689168722947833, 0.724139381655805, 0.758777612874759, 0.793037198699874, 0.826872426454116, 0.860238149682804, 0.893089848392678, 0.925383688455069, 0.957076580093919, 0.988126235380611, 1.018491224658889, 1.048131031824584, 1.077006108386382, 1.105077926235508, 1.132309029053906, 1.158663082292324, 1.184104921651626, 1.208600600002625, 1.232117432681854, 1.254624041102815, 1.276090394624532, 1.296487850621530, 1.315789192701786, 1.333968667021650, 1.351002016649281, 1.366866513930749, 1.381540990815622, 1.395005867101560, 1.407243176560245, 1.418236590909780, 1.427971441601564, 1.436434739392588, 1.443615191677024, 1.449503217553984, 1.454090960611347, 1.457372299408598, 1.459342855644686, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.460000000000000, 1.456723981389429, 1.447003248537083, 1.431156254460289, 1.409702149634220, 1.383343774525708, 1.352944634408754, 1.319500610771041, 1.284107336051064, 1.247924300515543, 1.212136867142489, 1.177917438909449, 1.146387050653769, 1.118578643762690};
  Y = Eigen::Map<Eigen::VectorXd>(y.data(), y.size());
  track.gen2DSpline(X, Y);
  std::vector<double> plot_xc(X.data(),X.data() + X.size());
  std::vector<double> plot_yc(Y.data(),Y.data() + Y.size());
  plt::figure(1);
  plt::plot(plot_xc,plot_yc,"r--");
  plt::show();



  // while (ros::ok()) {
  //   ros::spinOnce();
  //   mission.process();
  //   rate.sleep();
  // }
  return 0;
}